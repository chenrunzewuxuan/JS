webpackJsonp([34],{0:function(e,t,a){var n=a(1),i=a(50);a(49),a(52),a(55),n(function(){if(n("#content").delegate(".hp-qh","click",function(e){var t=n(this),a=t.next();"block"===a.css("display")?a.css("display","none"):a.css("display","block")}),i.init(document),"#fromindex"===window.location.hash){var e=n("a[data-sendto]");e.length&&e.click()}})},49:function(e,t,a){(function(e){!function(){e.fn.replyPages=function(t){t=e.extend({},e.fn.replyPages.defaults,t);var a=e(this),n=function(){t.totalPages=Math.ceil(t.totalCount/t.pageCount),i()},i=function(){a.find(t.pageContent).empty().append(r()).removeClass("dn");var n=a.data("callRepos");n&&e.isFunction(n)&&n()},r=function(){var e='<ul class="dib">',a=(t.showPages-1)/2,n=function(){t.pageType&&(e+='<li class="pbrw gray">('+t.currentPage+"/"+t.totalPages+")</li>"),1!==t.currentPage&&(e+='<li class="prew"><a class="pre" data-page="'+(t.currentPage-1)+'" href="javascript:;">&nbsp;</a></li>'),t.pageType||(e+=1!==t.currentPage?'<li><a href="javascript:;" data-page="1">1</a></li>':'<li class="cur">1</li>',t.startPage>2&&(e+='<li class="lt">...</li>'))},i=function(a){e+=a===t.currentPage?'<li class="cur">'+a+"</li>":'<li><a href="javascript:;" data-page="'+a+'">'+a+"</a></li>"},r=function(){t.pageType||(t.endPage<t.totalPages-1&&(e+='<li class="gt">...</li>'),e+=t.currentPage!==t.totalPages?'<li><a href="javascript:;" data-page="'+t.totalPages+'">'+t.totalPages+"</a></li>":'<li class="cur">'+t.totalPages+"</li>"),t.currentPage!==t.totalPages&&(e+='<li class="next"><a class="nxt nxtw" data-page="'+(t.currentPage+1)+'" href="javascript:;">下一页</a></li>'),e+="</ul>"};if(t.currentPage-a<2?t.startPage=2:t.startPage=t.currentPage-a,t.currentPage+a>=t.totalPages?t.endPage=t.totalPages-1:t.endPage=t.currentPage+a,n(),!t.pageType)for(var s=0;s<t.endPage-t.startPage+1;s++){var o=t.startPage+s;i(o)}return r(),e};n()},e.fn.replyPages.defaults={showPages:9,currentPage:1,startPage:2,endPage:10,totalPages:0,totalCount:0,pageCount:20,pageType:0,pageContent:"#js-reply-page"}}(),function(){e.fn.Reply=function(t){function a(){if(m){switch(m.c){case 0:t.typeMessage="comment_message_id";break;case 1:t.typeMessage="comment_group_topic_id";break;case 2:t.typeMessage="comment_event_topic_id";break;case 3:t.typeMessage="comment_album_id"}i(1),setLabelIptFocus("#txa-cmt-reply","#txa-cmt-label");var a=e("#form-cmt-reply");a.delegate(".sub-cmt-reply","click",function(t){e.G.getUSERID()?p(a):SUGAR.PopOut.login()}),f.delegate(".rreply","click",function(t){return t.preventDefault(),t.stopPropagation(),e.G.getUSERID()?void d(this):void SUGAR.PopOut.login()}),f.delegate(".rrp-cancle","click",function(t){t.preventDefault(),t.stopPropagation();var a=e(this),i=a.closest(".cmt-list");i.find(".rrp-content").animate({height:0},"fast",function(){e(this).remove(),n(i),i.find(".rreply").removeClass("dn")})}),e("#js-reply-page").delegate("a","click",function(t){t.preventDefault(),t.stopPropagation(),e.G.scrollToAnchor("replytop",70),r(this)}),f.confirm(function(t){var a=e(this),n=a.data("confirm"),i=a.closest(".cmt-list");e.post(n,function(){}),i.slideUp(function(){i.remove(),s(-1,0)})},"[data-confirm]",{tipword:"确定要删除？"})}}function n(t){e.browser.msie&&t.closest(".reply-list").attr("class",function(e,t){return t})}function i(a){var n=e.G.store(),i=e("#page-"+t.currentPage);return n.length||e("body").append('<div id="win-house" class="h0"></div>'),f.find(".cmt-list").wrapAll('<div id="page-'+t.prevPage+'"></div>'),n.append(e("#page-"+t.prevPage)),e("#js-reply-page").empty(),i.length?(f.prepend(i.children()),i.remove(),void f.replyPages({totalCount:t.totalCount,showPages:9,currentPage:t.currentPage,pageType:m.t,pageCount:m.p})):(f.addClass("loading"),void u({url:"/napi/comment/list/",type:"GET",data:{start:(t.currentPage-1)*m.p,comment_message_id:m.r,limit:m.p},successFn:function(e){if(e=e.data){t.nextCount=e.next,t.totalCount=e.total,s(0,e.total);var n=o(e.object_list);f.prepend(n),m.p<e.total&&f.replyPages({totalCount:e.total,showPages:9,currentPage:t.currentPage,pageType:m.t,pageCount:m.p}),f.data("loaded",1),f.find(".G-turnlink").turnlink(),a&&"undefined"!=typeof fusion2&&fusion2.canvas&&fusion2.canvas.setHeight({height:0}),!a&&"undefined"!=typeof fusion2&&fusion2.canvas&&(fusion2.canvas.setScroll({top:20}),fusion2.canvas.setHeight({height:0}))}}}))}function r(a){var n=e(a);t.prevPage=t.currentPage,t.currentPage=n.data("page"),i(0)}function s(e,a){a?t.totalCount=a:t.totalCount=t.totalCount+e,g.find("i").text(t.totalCount),t.totalCount?g.removeClass("dn"):(1===m.c||3===m.c)&&g.addClass("dn")}function o(e){for(var t="",a=0,n=e.length;n>a;a++)t+=l(e[a],"",0,a);return t}function l(a,n,i,r){var s=function(){return e.G.getUSERID()===a.fromUserId||e.G.isSTAFF()?'<a href="javascript:;" data-confirm="/napi/comment/delete/?comment_id='+a.id+'" class="r lkl mreplydelete">删除</a>':""}(),o=function(){return a.recipient?'<span>回复 </span><a class="ppname" href="/people/?user_id='+a.recipient.id+'">'+a.recipient.username+"</a><span>：</span>":""}(),l=function(){return e.G.dtImageTrans(a.sender.avatar,!0,48,48,"c")}(),c=function(){var e,a=" | ";return 2===m.c?(e=t.totalCount-m.p*(t.currentPage-1)-r,e>0?a+e+"楼":""):""}();return['<div class="cmt-list ',n,'"><dl data-config=\'{"id":"',a.id,'","rid":"',a.sender.id,'"}\'><dt class="cmt-avatar"><a href="/people/?user_id=',a.sender.id,'"><img height="48" width="48" src="',l,'"></a></dt><dd><h3>',s,'<a class="ppname" href="/people/?user_id=',a.sender.id,'">',a.sender.username,"</a><i>",a.add_datetime,c,'</i></h3><div class="cmt-ctnt">',o,'<span class="G-turnlink">',a.content,'</span><a class="rreply lkl ml8" href="javascript:;">回复</a></div></dd></dl></div>'].join("")}function c(a,i){a.parent().find("a.uploadpic-delthepic").click(),f=e("#replycont-main"),s(1,0),t.totalCount<=1?i.hide().prependTo(f):1===m.s?f.find(".cmt-list:last").after(i.hide()):f.find(".cmt-list:first").length<1?i.hide().prependTo(f):f.find(".cmt-list:first").before(i.hide()),i.show("fast",function(){if(n(i),1==m.c){var t=e.browser,a=t.webkit,r=e(a?"body":"html"),s=i.offset().top,o=80;r.animate({scrollTop:s-o},400)}}),i.find(".G-turnlink").turnlink(),window.setTimeout(function(){var t=f.data("callRepos");t&&e.isFunction(t)&&t()},1e3)}function p(a){var n=e.trim(a.find("textarea").val());if(""==n)return void alert("请输入内容！");var i=a.parent().find("a.uploadpic-thepic");i.length&&(n+="[["+i.attr("href")+"]]");var r={content:n,_type:m.c};r[t.typeMessage]=e("#replycont-main").data("config").r,u({form:a,url:a.getFormAction(),type:a.attr("method"),data:r,successFn:function(t){var n=l({id:t.data.id,fromUserId:e.G.getUSERID(),portrait:"undefined"!=typeof USER?USER.smallAvatar:"",fromUsername:"undefined"!=typeof USER?USER.username:"",daymsg:"刚刚",add_datetime:"刚刚",msg:t.data.content,sender:{id:e.G.getUSERID(),avatar:"undefined"!=typeof USER?USER.smallAvatar:"",username:"undefined"!=typeof USER?USER.username:""},content:t.data.content},"",1,0),i=e(n);c(a,i)}})}function d(a){var i=e(a),r=i.closest(".cmt-ctnt"),s=i.closest("dl"),o=i.closest(".cmt-list"),p=o.find(".ppname").eq(0).text(),d=s.data("config"),f=e('<div class="rrp-content '+(1==m.c?"reply-textpic":"")+' rrp-cont"><form method="post" action="/napi/comment/create/"><div class="reply-editcont"><textarea class="txa" name="content"></textarea></div><div class="rrp-tail clr"><a href="javascript:;" class="rrp-submit abtn l"><button type="button" ><u>回复</u></button></a><a class="rrp-cancle" href="javascript:;">取消</a></div><input type="hidden" name="_type" value=""></form>'+(1==m.c?'<div class="reply-addpic dn"><div class="reply-addpicin"><a class="abtn-up dib" href="javascript:;"><form class="form-reply-uppic" target="alupifr" enctype="multipart/form-data" method="POST" action="/upload/photo/"><input name="img" hidefocus="true" type="file" /><input type="hidden" name="tid" value=""/><input type="hidden" name="callback" value="$.fn.uploadpic.upPicCallBack"/><iframe name="alupifr" src="about:blank" class="dn" scrolling="no" frameborder="0" height="0" width="0"></iframe><input type="hidden" name="type" value="reply"/></form></a><div class="reply-normal dib gray ml8 l20">可上传一张jpg、png、gif格式的图片，且图片小于2M</div><div class="reply-uploading dib loading3 dn"></div><div class="reply-uperror dib  ml8 l20 red dn"></div><div class="reply-uploaded dib  ml8 l20 dn"></div></div></div>':"")+"</div>"),g=f.hide().insertAfter(r).show("fast",function(){n(r)});f.find("[name=content]").focus(),e.fn.uploadpic&&f.find(".abtn-up").uploadpic(function(){},{sel_holder:".reply-addpic",sel_form:".form-reply-uppic",sel_normal:".reply-normal",sel_error:".reply-uperror",sel_uploading:".reply-uploading",sel_uploaded:".reply-uploaded"});var v=g.find("form");o.find(".rreply").addClass("dn"),v.find(".rrp-submit").click(function(a){if(a.preventDefault(),a.stopPropagation(),!e.G.getUSERID())return void SUGAR.PopOut.login();var n=e.trim(v.find("textarea").val());if(""==n)return void alert("请输入内容！");var i=v.parent().find("a.uploadpic-thepic");i.length&&(n+="[["+i.attr("href")+"]]");var r={content:n,_type:m.c,parent_id:d.id};r[t.typeMessage]=m.r,u({form:v,url:v.getFormAction(),type:v.attr("method"),data:r,successFn:function(t){var a=l({id:t.data.id,fromUserId:e.G.getUSERID(),parentId:1,toUserId:d.rid,toUsername:p,portrait:"undefined"!=typeof USER?USER.smallAvatar:"",fromUsername:"undefined"!=typeof USER?USER.username:"",daymsg:"刚刚",add_datetime:"刚刚",msg:t.data.content,sender:{id:e.G.getUSERID(),avatar:"undefined"!=typeof USER?USER.smallAvatar:"",username:"undefined"!=typeof USER?USER.username:""},recipient:{id:d.rid,username:p},content:t.data.content},"",1,0),n=e(a);c(v,n)}})})}function u(t){var a="Object"==typeof t.form?t.form:e(t.form),n=a.length,i="";if(!e.G.getUSERID()&&n)return void SUGAR.PopOut.login();if(n){if(i=a.find(".abtn"),i.hasClass("abtn-no"))return;i.addClass("abtn-no")}e.ajax({type:t.type,url:t.url,data:n?e.extend(t.data,getToken(2)):t.data,mysuccess:function(e,a){t.successFn(e)}}).always(function(){n&&(i.removeClass("abtn-no"),a.find("textarea").val("").css("height",42)),f.removeClass("loading")})}t=e.extend({},e.fn.Reply.defaults,t);var f=e(this),g=e("#js-cmt-count"),m=f.data("config");m.reply_type=parseInt(m.reply_type)||0,m.reply_ctype=parseInt(m.reply_ctype)||0,m.reply_pagenum=parseInt(m.reply_pagenum)||0,m.reply_sofa=parseInt(m.reply_sofa)||0,m.reply_count=parseInt(m.reply_count)||0,a()},e.fn.Reply.defaults={currentPage:1,prevPage:0,totalCount:0,nextCount:0,typeMessage:""}}(),e(function(){var t=e("#replycont-main");if(t.length){t.Reply();var a=e("#txa-cmt-reply");e.fn.at&&a.at({pageMembers:"#replycont-main .ppname"}),a.autogrow(),a.focus(function(){e.G.getUSERID()||SUGAR.PopOut.login()})}e.fn.uploadpic&&e("#reply-addpic-btn").uploadpic(function(){},{sel_holder:".reply-addpic",sel_form:".form-reply-uppic",sel_normal:".reply-normal",sel_error:".reply-uperror",sel_uploading:".reply-uploading",sel_uploaded:".reply-uploaded"})})}).call(t,a(1))},50:function(e,t,a){var n=a(1),i=a(4);a(51),a(9);var r=function(){function e(e){var a=n("#Mess-send");a.length||(a=n('<div id="Mess-send" class="win-wraper Mess-send"> <form id="form-message" method="post"> <input type="hidden" name="action" value="sendmsg"/> <textarea id="txa-message" name="msg" class="txa"></textarea> <div class="clr mt8"> <a class="abtn l" target="_self" href="javascript:;" ><button type="submit"><u>发送</u></button></a> </div> <input type="hidden" id="Mess-toid" name="user_id" value=""/> </form> </div>'),n.G.store(a)),a.find("form").safeSubmit(function(e){t(this)}),n("[data-sendto]",e).click(function(){if(!n.G.getUSERID())return void i.PopOut.login();var e=n(this),t=e.data("sendto");n("#Mess-toid").val(t.id),n(".abtn","#form-message").removeClass("abtn-no"),n("textarea","#Mess-send").val(""),i.PopOut.alert(['发送信息给<u class="red">'+t.name.cut(28,"…")+"</u>",a[0],""])})}function t(e,t,a){var r=n(e),s=r.find(".abtn");s.find("[type=submit]");s.hasClass("abtn-no")||(s.addClass("abtn-no"),n.ajax({url:"/napi/letter/create/",data:r.paramForm(),mysuccess:function(e,t){i.PopOut.alert('<div class="prompt prompt-success"><h3>发送消息成功！</h3></div>'),n({}).delay(1e3).queue(function(){i.PopOut.closeMask(0)})},myerror:function(){this.errormsg()}}).always(function(){s.removeClass("abtn-no")}))}return{init:e}}();e.exports=r},51:function(e,t,a){(function(e){!function(e){function t(e){e.preventDefault(),e.type="safeSubmit",a.handle?a.handle.apply(this,arguments):a.dispatch&&a.dispatch.apply(this,arguments)}var a=e.event;a.special;a.special.safeSubmit={setup:function(){var n=this;e(n);a.add(n,"submit",t)},teardown:function(){var n=this;e(n);a.remove(n,"submit",t)}},e.fn.safeSubmit=function(t,a,n){return"function"!=typeof n&&(n=a,a=t,t=null),n=n||function(){alert("请输入内容")},arguments.length>0?this.unbind("safeSubmit").bind("safeSubmit",t,function(t){var i=this,r=e(i),s=e("input[type=text],textarea",r).not("[data-optional]"),o=e("[type=submit]",r);safe=!0,s.each(function(t,a){""===e.trim(e(a).val())&&safe&&(safe=!1)}),o.each(function(t,a){e(a).prop("disabled")&&safe&&(safe=!1)}),safe?a.call(this,arguments):n.call(this,arguments)}):this.trigger("safeSubmit")}}(e)}).call(t,a(1))},52:function(e,t,a){(function(e,t){e(function(){e(".G-turnlink").turnlink()}),function(e){e.fn.turnlink=function(){return this.html(function(t,a){var n,i=[],r=[],s=/\[\[((?:http(?:s)?:\/\/)(?:(?:[\w-]+\.)+[\w-]+)(?:\:\d+)?(?:\/[\w-\.\/%]*)\.(tiff|psd|gif|png|bmp|tga|png|jpg|jpeg|img)?)\]\]/gi,o=/(?:http(?:s)?:\/\/)(?:(?:[\w-]+\.)+[\w-]+)(?:\:\d+)?(?:\/[\w-\.\/%]*)?(?:[?][\w-\.\/%!*\(\);\:@&=+$,\[\]]*)?(?:#[\w-\.\/%!*\(\);\:@&=+$,\[\]]*)?/gi;a=a.replace(s,function(t,a){return'<div class="turnlink-img"><img src="'+e.G.dtImageTrans(a,!0,600)+'" /></div>'}),n=a.replace(/<a[^>]*>[^<]*<\/a>/gi,function(e){var t=[];return t.length=e.length+1,t.join("*")}),n=n.replace(/<[^>]*>/gi,function(e){var t=[];return t.length=e.length+1,t.join("*")}),n.replace(o,function(e,t){i.push({url:e,pos:t})});for(var l=0,t=0;t<i.length;t++){var c=i[t].pos,p=i[t].url.length,d=i[t].url;r.push(a.substring(l,c)),r.push('<a href="'+d+'" target="_blank">'+d+"</a>"),l=c+p}return r.push(a.substring(l)),r.join("")}),this}}(t)}).call(t,a(1),a(1))},55:function(e,t,a){(function(e){!function(){e.G&&!e.G.reTop&&(e.G.reTop=function(){var t,a=e(window),n=a.width(),i=a.height(),r=e.browser,s=(r.msie&&"6.0"===r.version,r.webkit,!1),o=e("#dt-side-combo"),l=e("#dt-backtotop");if(!l.length){o=e('<div id="dt-side-combo" ><a id="dt-backtotop" class="dt-backtotop" href="javascript:;">回到顶部</a><a class="dt-app" href="/app/duitang/">手机应用</a><a class="dt-report" href="/leave/message/">反馈意见</a></div>').sidepop({id:"dt-side-combo",dockSide:"right",width:48,height:142,scroll:1,departure:10,baseline:"bottom",bias:30,isFixed:!0,zIndex:1e4,btnset:0}),o=o.parent().parent(),o.addClass("vh"),$comboin=e("#dt-side-combo"),l=e("#dt-backtotop"),l.click(function(t){t.preventDefault();s=!0,e("body,html").animate({scrollTop:0},200,function(){s=!1}),o.css("display","none")});var c=function(n){clearTimeout(t),s||(t=window.setTimeout(function(){var t=a.scrollTop();t>100?o.stop().css({display:"block"}).animate({opacity:1},300):o.stop().animate({opacity:0},300,function(){o.css("display","none")}),n&&e({}).delay(300).queue(function(){o.removeClass("vh")})},100))};a.scroll(c),c(!0);var p=function(){var e=17,t=n+e;if(1120>=t||t>1262&&1336>=t)o.css({left:"auto",right:10,marginLeft:0});else{var a=1262>=t?490:612;o.css({left:"50%",marginLeft:a})}};p(),a.resize(function(){n=a.width(),i=a.height(),p()})}},e(function(){e.G.reTop()}))}()}).call(t,a(1))}});